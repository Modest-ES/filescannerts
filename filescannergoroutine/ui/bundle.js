(()=>{"use strict";class e{constructor(e){this.mainShellElement=document.getElementById("directory-info"),this.controller=e}displayLoadElement(){const e=document.getElementById("load-animation");e&&(e.style.opacity="1",console.log("DISPLAY",e))}hideLoadElement(){const e=document.getElementById("load-animation");e&&(e.style.opacity="0",console.log("HIDE",e))}displayDirectoryData(e,t){if(this.mainShellElement){this.mainShellElement.innerHTML="";const n=this.createHeaderElement(e,t);this.mainShellElement.appendChild(n);const o=this.createContentElement(e);this.mainShellElement.appendChild(o);const a=this.createFooterElement();this.mainShellElement.appendChild(a)}}createHeaderElement(e,t){const n=document.createElement("header"),o=this.createLeftSideElement(e);n.appendChild(o);const a=this.createRightSideElement(e,t);return n.appendChild(a),n}createLeftSideElement(e){const t=document.createElement("div");t.classList.add("left-side");const n=document.createElement("button");n.classList.add("btn-back");const o=new URLSearchParams(window.location.search);"/home"==o.get("root")&&n.classList.add("blocked-btn"),n.addEventListener("click",(()=>this.controller.onBtnBackClicked()));const a=document.createElement("img");a.src="ui/img/leftarrow.png",a.alt="Back",a.title="/home"==o.get("root")?"/home is the main directory":"Return to the previous directory",n.appendChild(a),t.appendChild(n);const i=document.createElement("h2");return i.textContent=`Root: ${e.RootPath}`,t.appendChild(i),t}createRightSideElement(e,t){const n=document.createElement("div");n.classList.add("right-side");const o=document.createElement("div");o.classList.add("loadtime");const a=document.createElement("p");a.textContent="Loadtime:",o.appendChild(a);const i=document.createElement("p");if(i.textContent=e.Duration,o.appendChild(i),n.appendChild(o),0==e.Status){const e=document.createElement("button");e.classList.add("btn-sort"),e.addEventListener("click",(()=>this.controller.onBtnSortClicked()));const o=document.createElement("p");o.textContent="Sorting:",e.appendChild(o);const a=document.createElement("img");a.src="asc"==t?"ui/img/sortasc.png":"ui/img/sortdesc.png",a.alt=t,a.title="asc"==t?"Ascending":"Descending",e.appendChild(a),n.appendChild(e)}return n}createContentElement(e){const t=document.createElement("div");if(t.classList.add("content"),0!=e.Status){const n=this.createErrorElement(e);t.appendChild(n)}if(null==e.FilesList){const e=this.createNullElement();t.appendChild(e)}else e.FilesList.forEach((e=>{const n=this.createFilelineElement(e);t.appendChild(n)}));return t}createErrorElement(e){const t=document.createElement("div");t.classList.add("error-message");const n=document.createElement("img");n.src="ui/img/error.png",n.alt="Error",n.title=e.ErrorMessage,t.appendChild(n);const o=document.createElement("p");return o.textContent=e.ErrorMessage,t.appendChild(o),t}createNullElement(){const e=document.createElement("div");e.classList.add("null-element");const t=document.createElement("img");t.src="ui/img/warning.png",t.alt="Warning",t.title="Текущая директория пустая",e.appendChild(t);const n=document.createElement("p");return n.textContent="Текущая директория пустая",e.appendChild(n),e}createFilelineElement(e){const t=document.createElement("div");t.classList.add("fileline"),"Folder"==e.FileType&&t.addEventListener("click",(()=>this.controller.onFilelineClicked(e)));const n=document.createElement("div");n.classList.add("file-type");const o=document.createElement("img");o.src="Folder"==e.FileType?"ui/img/folder.png":"ui/img/file.png",o.alt=e.FileType,o.title=e.FileType,o.width=20,o.height=20,n.appendChild(o);const a=document.createElement("p");a.textContent=e.FileType,n.appendChild(a),t.appendChild(n);const i=document.createElement("p");i.classList.add("file-name"),i.textContent=e.FileName,t.appendChild(i);const c=document.createElement("p");return c.classList.add("file-size"),c.textContent=e.FileSizeString,t.appendChild(c),t}createFooterElement(){const e=document.createElement("footer"),t=document.createElement("p");return t.textContent="® File Scanner 2024",e.appendChild(t),e}}const t=new class{constructor(){this.data=null}verifyUrlParameters(){const e=new URLSearchParams(window.location.search);if(!e.has("sort")){const e=new URL(window.location.href);e.searchParams.set("sort","asc"),window.location.href=e.toString()}if(!e.has("root")){const e=new URL(window.location.href);e.searchParams.set("root","/home"),window.location.href=e.toString()}}getSortParameter(){return new URLSearchParams(window.location.search).get("sort")||""}constructUrl(){const e=new URLSearchParams(window.location.search),t=e.get("sort"),n=e.get("root");let o="./files";return n&&(o+=`?root=${n}`),o+=t?`&sort=${t}`:"&sort=asc",o}fetchData(e){return t=this,n=void 0,a=function*(){try{const t=yield fetch(e),n=yield t.json();this.data=n,console.log(n)}catch(e){console.error("Error fetching the directory data : ",e)}},new((o=void 0)||(o=Promise))((function(e,i){function c(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(c,r)}l((a=a.apply(t,n||[])).next())}));var t,n,o,a}},n=new class{constructor(t){this.model=t,this.view=new e(this)}loadDirectoryData(){this.view.displayLoadElement(),this.model.verifyUrlParameters(),this.model.fetchData(this.model.constructUrl()).then((()=>{this.view.displayDirectoryData(this.model.data,this.model.getSortParameter())})),this.view.hideLoadElement()}onBtnBackClicked(){const e=new URLSearchParams(window.location.search),t=e.get("root").lastIndexOf("/"),n=e.get("root").substring(0,t),o=`${window.location.pathname}?root=${n||e.get("root")}&sort=${e.get("sort")}`;window.history.pushState({path:o},"",o),this.loadDirectoryData()}onBtnSortClicked(){const e=new URLSearchParams(window.location.search);let t=e.get("sort");t="desc"===t?"asc":"desc";const n=`${window.location.pathname}?root=${e.get("root")}&sort=${t}`;window.history.pushState({path:n},"",n),this.loadDirectoryData()}onFilelineClicked(e){const t=new URLSearchParams(window.location.search),n=`${window.location.pathname}?root=${t.get("root")}/${e.FileName}&sort=${t.get("sort")}`;window.history.pushState({path:n},"",n),this.loadDirectoryData()}}(t);n.loadDirectoryData()})();